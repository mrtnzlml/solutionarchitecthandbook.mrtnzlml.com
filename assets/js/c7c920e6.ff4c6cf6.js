"use strict";(self.webpackChunkuniversity=self.webpackChunkuniversity||[]).push([[5550],{1395:(e,n,a)=>{a.r(n),a.d(n,{assets:()=>d,contentTitle:()=>u,default:()=>f,frontMatter:()=>o,metadata:()=>t,toc:()=>c});const t=JSON.parse('{"id":"learn/rossum-formulas/index","title":"Rossum Formulas","description":"This section covers both the Rossum Formula Fields and the Serverless Functions (Formula Fields flavor in custom extensions).","source":"@site/docs/learn/rossum-formulas/index.md","sourceDirName":"learn/rossum-formulas","slug":"/learn/rossum-formulas/","permalink":"/docs/learn/rossum-formulas/","draft":false,"unlisted":false,"tags":[],"version":"current","sidebarPosition":1,"frontMatter":{"title":"Rossum Formulas","sidebar_position":1},"sidebar":"learnSidebar","previous":{"title":"Postman collection","permalink":"/docs/learn/netsuite/postman"},"next":{"title":"Formula fields","permalink":"/docs/learn/rossum-formulas/formula-fields"}}');var r=a(4848),s=a(8453),l=a(1470),i=a(9365);const o={title:"Rossum Formulas",sidebar_position:1},u=void 0,d={},c=[{value:"Installation",id:"installation",level:2},{value:"Basic usage",id:"basic-usage",level:2},{value:"Available functions and features",id:"available-functions-and-features",level:2},{value:"Working with datapoints",id:"working-with-datapoints",level:3},{value:"Working with annotation data",id:"working-with-annotation-data",level:3},{value:"Check whether datapoint is set or not",id:"check-whether-datapoint-is-set-or-not",level:3},{value:"Defaulting values",id:"defaulting-values",level:3},{value:"Substitute",id:"substitute",level:3},{value:"Show info/warning/error messages",id:"show-infowarningerror-messages",level:3},{value:"Set automation blockers",id:"set-automation-blockers",level:3},{value:"Create multivalue field values",id:"create-multivalue-field-values",level:3},{value:"Create enum field options",id:"create-enum-field-options",level:3}];function h(e){const n={a:"a",admonition:"admonition",code:"code",h2:"h2",h3:"h3",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",...(0,s.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)(n.p,{children:["This section covers both the Rossum ",(0,r.jsx)(n.strong,{children:"Formula Fields"})," and the ",(0,r.jsx)(n.strong,{children:"Serverless Functions"})," (Formula Fields flavor in custom extensions)."]}),"\n",(0,r.jsx)(n.h2,{id:"installation",children:"Installation"}),"\n",(0,r.jsx)(n.p,{children:"Formula Fields or Serverless Functions do not require any installation. They are both available as a native Rossum functionality."}),"\n",(0,r.jsxs)(n.p,{children:["Formula Fields are available in the queue schema as a ",(0,r.jsx)(n.code,{children:"formula"})," field type. In serverless functions, you can import ",(0,r.jsx)(n.code,{children:"TxScript"})," library which is a wrapper introducing the same functionality into serverless functions. Both flavors are fundamentally similar and differ only in how they are used with minimal syntax differences."]}),"\n",(0,r.jsx)(n.p,{children:"In case you want to use the TxScript within pre-existing serverless functions, you need to enable following setting:"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsx)(n.li,{children:"Go to the settings of the Webhook (Serverless function)"}),"\n",(0,r.jsxs)(n.li,{children:["Scroll to ",(0,r.jsx)(n.code,{children:"Additional notification metadata"})]}),"\n",(0,r.jsxs)(n.li,{children:["Enable the ",(0,r.jsx)(n.code,{children:"Schemas"})," option"]}),"\n",(0,r.jsxs)(n.li,{children:["Save it, and now you can work with the ",(0,r.jsx)(n.code,{children:"TxScript"})," in your serverless function"]}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"basic-usage",children:"Basic usage"}),"\n",(0,r.jsx)(n.p,{children:"To start with Formula Fields, follow these steps:"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:["Create a new ",(0,r.jsx)(n.code,{children:"order_id_normalized"})," field in the queue schema."]}),"\n",(0,r.jsxs)(n.li,{children:["Select the ",(0,r.jsx)(n.code,{children:"formula"})," field type of the field."]}),"\n",(0,r.jsxs)(n.li,{children:["Write the formula in the ",(0,r.jsx)(n.code,{children:"formula"})," field."]}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:"Your first formula can be as simple as (no returns, no imports):"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-py",children:"field.order_id\n"})}),"\n",(0,r.jsxs)(n.p,{children:["This formula copies the ",(0,r.jsx)(n.code,{children:"order_id"})," field into your newly created Formula Field."]}),"\n",(0,r.jsx)(n.p,{children:"Alternatively, you can create a new serverless (Python) function with the following boilerplate code that does the same thing:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-py",children:"from txscript import TxScript\n\ndef rossum_hook_request_handler(payload):\n    t = TxScript.from_payload(payload)\n\n    t.field.order_id_normalized = t.field.order_id  # Copies `order_id` value into `order_id_normalized`\n\n    return t.hook_response()\n"})}),"\n",(0,r.jsxs)(n.p,{children:["Notice that it is a little bit more verbose, but it is still very similar. The main differences are that we need to wrap the functionality into ",(0,r.jsx)(n.code,{children:"rossum_hook_request_handler"})," function and that we need to explicitly write into the ",(0,r.jsx)(n.code,{children:"order_id_normalized"})," field."]}),"\n",(0,r.jsx)(n.p,{children:"This is an illustrative example. In case you only need to modify an existing field value, always prefer making it a formula field."}),"\n",(0,r.jsxs)(n.p,{children:["For backward compatibility, you can also use the following import which works the same way as ",(0,r.jsx)(n.code,{children:"TxScript"}),":"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-py",children:"from rossum_python import RossumPython\n\n# \u2026\n"})}),"\n",(0,r.jsx)(n.h2,{id:"available-functions-and-features",children:"Available functions and features"}),"\n",(0,r.jsxs)(n.p,{children:["Here is a list of available functions and features and their comparison between ",(0,r.jsx)(n.a,{href:"/docs/learn/rossum-formulas/formula-fields",children:"Formula Fields"})," and ",(0,r.jsx)(n.a,{href:"/docs/learn/rossum-formulas/serverless-functions",children:"Serverless Functions"}),". Note that serverless functions examples always assume that the code is wrapped in ",(0,r.jsx)(n.code,{children:"rossum_hook_request_handler"})," function like so:"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-py",children:"from txscript import TxScript\n\ndef rossum_hook_request_handler(payload):\n    t = TxScript.from_payload(payload)\n\n    # INSERT THE EXAMPLES HERE\n\n    return t.hook_response()\n"})}),"\n",(0,r.jsx)(n.p,{children:"Formula field examples do not require any further modification."}),"\n",(0,r.jsx)(n.h3,{id:"working-with-datapoints",children:"Working with datapoints"}),"\n",(0,r.jsxs)(l.A,{groupId:"rossum-formulas-flavor",children:[(0,r.jsxs)(i.A,{value:"formula_field",label:"Formula field",default:!0,children:[(0,r.jsx)(n.p,{children:"Getting values (or meta information):"}),(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-py",children:"field.amount                            # Get datapoint value\nfield.amount.id                         # Get datapoint system ID\nfield.amount.attr.rir_confidence        # Get confidence score\nfield.amount.attr.ocr_raw_text          # Get raw value extracted by OCR, if applicable\nfield.amount.attr.rir_raw_text          # Get raw extracted text by RIR\n"})}),(0,r.jsx)(n.admonition,{type:"warning",children:(0,r.jsx)(n.p,{children:"Formula fields cannot write into any other fields. They simply return the value into the formula field itself."})})]}),(0,r.jsxs)(i.A,{value:"serverless_function",label:"Serverless function",children:[(0,r.jsx)(n.p,{children:"Getting values (or meta information):"}),(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-py",children:"t.field.amount                          # Get datapoint value\nt.field.amount.id                       # Get datapoint system ID\nt.field.amount.rir_confidence           # Get confidence score\nt.field.amount.attr.ocr_raw_text        # Get raw value extracted by OCR, if applicable\nt.field.amount.attr.rir_raw_text        # Get raw extracted text by RIR\n"})}),(0,r.jsx)(n.p,{children:"Writing values:"}),(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-py",children:"t.field.amount = 10\n"})})]})]}),"\n",(0,r.jsx)(n.h3,{id:"working-with-annotation-data",children:"Working with annotation data"}),"\n",(0,r.jsxs)(l.A,{groupId:"rossum-formulas-flavor",children:[(0,r.jsx)(i.A,{value:"formula_field",label:"Formula field",default:!0,children:(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-py",children:"annotation.id                                       # Get annotation ID\nannotation.metadata                                 # Get annotation metadata\nannotation.document.original_file_name              # Get document original file name\nannotation.email.subject                            # Get email subject\n"})})}),(0,r.jsx)(i.A,{value:"serverless_function",label:"Serverless function",children:(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-py",children:"t.annotation.id                                     # Get annotation ID\nt.annotation.metadata                               # Get annotation metadata\nt.annotation.document.original_file_name            # Get document original file name\nt.annotation.email.subject                          # Get email subject\n"})})})]}),"\n",(0,r.jsx)(n.h3,{id:"check-whether-datapoint-is-set-or-not",children:"Check whether datapoint is set or not"}),"\n",(0,r.jsxs)(l.A,{groupId:"rossum-formulas-flavor",children:[(0,r.jsx)(i.A,{value:"formula_field",label:"Formula field",default:!0,children:(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-py",children:"is_set(field.amount)        # Returns `true` if datapoint is set (has value)\nis_empty(field.amount)      # Opposite of `is_set`\n"})})}),(0,r.jsx)(i.A,{value:"serverless_function",label:"Serverless function",children:(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-py",children:"from txscript import TxScript, is_set, is_empty\n\n# \u2026\n\nis_set(t.field.amount)      # Returns `true` if datapoint is set (has value)\nis_empty(t.field.amount)    # Opposite of `is_set`\n"})})})]}),"\n",(0,r.jsx)(n.h3,{id:"defaulting-values",children:"Defaulting values"}),"\n",(0,r.jsx)(n.p,{children:"Use the default value if the field is empty."}),"\n",(0,r.jsxs)(l.A,{groupId:"rossum-formulas-flavor",children:[(0,r.jsx)(i.A,{value:"formula_field",label:"Formula field",default:!0,children:(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-py",children:"default_to(field.amount, 0)\n"})})}),(0,r.jsx)(i.A,{value:"serverless_function",label:"Serverless function",children:(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-py",children:"from txscript import TxScript, default_to\n\n# \u2026\n\ndefault_to(t.field.amount, 0)\n"})})})]}),"\n",(0,r.jsx)(n.h3,{id:"substitute",children:"Substitute"}),"\n",(0,r.jsxs)(n.p,{children:["Substitute is an alias for ",(0,r.jsx)(n.a,{href:"https://docs.python.org/3/library/re.html#re.sub",children:(0,r.jsx)(n.code,{children:"re.sub"})})," function (for convenience)."]}),"\n",(0,r.jsxs)(l.A,{groupId:"rossum-formulas-flavor",children:[(0,r.jsxs)(i.A,{value:"formula_field",label:"Formula field",default:!0,children:[(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-py",children:'substitute(r"[^0-9]", r"", field.document_id)  # Remove non-digit characters\n'})}),(0,r.jsxs)(n.p,{children:["Could also be written as (",(0,r.jsx)(n.code,{children:"re"})," is imported automatically):"]}),(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-py",children:'re.sub(r"[^0-9]", r"", field.document_id)\n'})})]}),(0,r.jsx)(i.A,{value:"serverless_function",label:"Serverless function",children:(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-py",children:'from txscript import TxScript, substitute\n\n# \u2026\n\nsubstitute(r"[^0-9]", r"", t.field.document_id)\n'})})})]}),"\n",(0,r.jsx)(n.h3,{id:"show-infowarningerror-messages",children:"Show info/warning/error messages"}),"\n",(0,r.jsx)(n.admonition,{type:"note",children:(0,r.jsxs)(n.p,{children:["Messages do not affect the automation behavior and, therefore, automation blockers must be set explicitly (see how to set ",(0,r.jsx)(n.a,{href:"#set-automation-blockers",children:"automation blockers"}),"). The only exception is ",(0,r.jsx)(n.code,{children:"show_error"})," which always blocks the automation."]})}),"\n",(0,r.jsxs)(l.A,{groupId:"rossum-formulas-flavor",children:[(0,r.jsx)(i.A,{value:"formula_field",label:"Formula field",default:!0,children:(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-py",children:'show_info("\u2026")                          # Show global info message\nshow_info("\u2026", field.amount)            # Show info message on the specified field\n\nshow_warning("\u2026")                       # Show global warning message\nshow_warning("\u2026", field.amount)         # Show warning message on the specified field\n\nshow_error("\u2026")                         # Show global error message\nshow_error("\u2026", field.amount)           # Show error message on the specified field\n'})})}),(0,r.jsx)(i.A,{value:"serverless_function",label:"Serverless function",children:(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-py",children:'t.show_info("\u2026")                        # Show global info message\nt.show_info("\u2026", t.field.amount)        # Show info message on the specified field\n\nt.show_warning("\u2026")                     # Show global warning message\nt.show_warning("\u2026", t.field.amount)     # Show warning message on the specified field\n\nt.show_error("\u2026")                       # Show global error message\nt.show_error("\u2026", t.field.amount)       # Show error message on the specified field\n'})})})]}),"\n",(0,r.jsx)(n.h3,{id:"set-automation-blockers",children:"Set automation blockers"}),"\n",(0,r.jsx)(n.admonition,{type:"note",children:(0,r.jsx)(n.p,{children:"Automation blockers must be set independently of the info/warning messages. Error messages block the automation by default (cannot be disabled)."})}),"\n",(0,r.jsxs)(l.A,{groupId:"rossum-formulas-flavor",children:[(0,r.jsx)(i.A,{value:"formula_field",label:"Formula field",default:!0,children:(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-py",children:'automation_blocker("message", field.amount)\n'})})}),(0,r.jsx)(i.A,{value:"serverless_function",label:"Serverless function",children:(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-py",children:'t.automation_blocker("message", t.field.amount)\n'})})})]}),"\n",(0,r.jsx)(n.h3,{id:"create-multivalue-field-values",children:"Create multivalue field values"}),"\n",(0,r.jsxs)(l.A,{groupId:"rossum-formulas-flavor",children:[(0,r.jsx)(i.A,{value:"formula_field",label:"Formula field",default:!0,children:(0,r.jsx)(n.admonition,{type:"warning",children:(0,r.jsx)(n.p,{children:"Multivalue formula fields are currently not supported (only serverless functions)."})})}),(0,r.jsx)(i.A,{value:"serverless_function",label:"Serverless function",children:(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-py",children:'t.field.multivalue_field.all_values = ["AAA", "BBB"]\n'})})})]}),"\n",(0,r.jsx)(n.h3,{id:"create-enum-field-options",children:"Create enum field options"}),"\n",(0,r.jsxs)(l.A,{groupId:"rossum-formulas-flavor",children:[(0,r.jsx)(i.A,{value:"formula_field",label:"Formula field",default:!0,children:(0,r.jsx)(n.admonition,{type:"warning",children:(0,r.jsx)(n.p,{children:"Changing enum field options is currently not supported in formula fields (only serverless functions)."})})}),(0,r.jsx)(i.A,{value:"serverless_function",label:"Serverless function",children:(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-py",children:'t.field.enum_field.attr.options = [{"label":"AAA", "value":"aaa"}, {"label":"BBB", "value":"bbb"}]\nt.field.enum_field = "bbb"\n'})})})]})]})}function f(e={}){const{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(h,{...e})}):h(e)}},9365:(e,n,a)=>{a.d(n,{A:()=>l});a(6540);var t=a(4164);const r={tabItem:"tabItem_Ymn6"};var s=a(4848);function l(e){let{children:n,hidden:a,className:l}=e;return(0,s.jsx)("div",{role:"tabpanel",className:(0,t.A)(r.tabItem,l),hidden:a,children:n})}},1470:(e,n,a)=>{a.d(n,{A:()=>y});var t=a(6540),r=a(4164),s=a(3104),l=a(6347),i=a(205),o=a(7485),u=a(1682),d=a(679);function c(e){return t.Children.toArray(e).filter((e=>"\n"!==e)).map((e=>{if(!e||(0,t.isValidElement)(e)&&function(e){const{props:n}=e;return!!n&&"object"==typeof n&&"value"in n}(e))return e;throw new Error(`Docusaurus error: Bad <Tabs> child <${"string"==typeof e.type?e.type:e.type.name}>: all children of the <Tabs> component should be <TabItem>, and every <TabItem> should have a unique "value" prop.`)}))?.filter(Boolean)??[]}function h(e){const{values:n,children:a}=e;return(0,t.useMemo)((()=>{const e=n??function(e){return c(e).map((e=>{let{props:{value:n,label:a,attributes:t,default:r}}=e;return{value:n,label:a,attributes:t,default:r}}))}(a);return function(e){const n=(0,u.XI)(e,((e,n)=>e.value===n.value));if(n.length>0)throw new Error(`Docusaurus error: Duplicate values "${n.map((e=>e.value)).join(", ")}" found in <Tabs>. Every value needs to be unique.`)}(e),e}),[n,a])}function f(e){let{value:n,tabValues:a}=e;return a.some((e=>e.value===n))}function m(e){let{queryString:n=!1,groupId:a}=e;const r=(0,l.W6)(),s=function(e){let{queryString:n=!1,groupId:a}=e;if("string"==typeof n)return n;if(!1===n)return null;if(!0===n&&!a)throw new Error('Docusaurus error: The <Tabs> component groupId prop is required if queryString=true, because this value is used as the search param name. You can also provide an explicit value such as queryString="my-search-param".');return a??null}({queryString:n,groupId:a});return[(0,o.aZ)(s),(0,t.useCallback)((e=>{if(!s)return;const n=new URLSearchParams(r.location.search);n.set(s,e),r.replace({...r.location,search:n.toString()})}),[s,r])]}function p(e){const{defaultValue:n,queryString:a=!1,groupId:r}=e,s=h(e),[l,o]=(0,t.useState)((()=>function(e){let{defaultValue:n,tabValues:a}=e;if(0===a.length)throw new Error("Docusaurus error: the <Tabs> component requires at least one <TabItem> children component");if(n){if(!f({value:n,tabValues:a}))throw new Error(`Docusaurus error: The <Tabs> has a defaultValue "${n}" but none of its children has the corresponding value. Available values are: ${a.map((e=>e.value)).join(", ")}. If you intend to show no default tab, use defaultValue={null} instead.`);return n}const t=a.find((e=>e.default))??a[0];if(!t)throw new Error("Unexpected error: 0 tabValues");return t.value}({defaultValue:n,tabValues:s}))),[u,c]=m({queryString:a,groupId:r}),[p,x]=function(e){let{groupId:n}=e;const a=function(e){return e?`docusaurus.tab.${e}`:null}(n),[r,s]=(0,d.Dv)(a);return[r,(0,t.useCallback)((e=>{a&&s.set(e)}),[a,s])]}({groupId:r}),v=(()=>{const e=u??p;return f({value:e,tabValues:s})?e:null})();(0,i.A)((()=>{v&&o(v)}),[v]);return{selectedValue:l,selectValue:(0,t.useCallback)((e=>{if(!f({value:e,tabValues:s}))throw new Error(`Can't select invalid tab value=${e}`);o(e),c(e),x(e)}),[c,x,s]),tabValues:s}}var x=a(2303);const v={tabList:"tabList__CuJ",tabItem:"tabItem_LNqP"};var g=a(4848);function b(e){let{className:n,block:a,selectedValue:t,selectValue:l,tabValues:i}=e;const o=[],{blockElementScrollPositionUntilNextRender:u}=(0,s.a_)(),d=e=>{const n=e.currentTarget,a=o.indexOf(n),r=i[a].value;r!==t&&(u(n),l(r))},c=e=>{let n=null;switch(e.key){case"Enter":d(e);break;case"ArrowRight":{const a=o.indexOf(e.currentTarget)+1;n=o[a]??o[0];break}case"ArrowLeft":{const a=o.indexOf(e.currentTarget)-1;n=o[a]??o[o.length-1];break}}n?.focus()};return(0,g.jsx)("ul",{role:"tablist","aria-orientation":"horizontal",className:(0,r.A)("tabs",{"tabs--block":a},n),children:i.map((e=>{let{value:n,label:a,attributes:s}=e;return(0,g.jsx)("li",{role:"tab",tabIndex:t===n?0:-1,"aria-selected":t===n,ref:e=>{o.push(e)},onKeyDown:c,onClick:d,...s,className:(0,r.A)("tabs__item",v.tabItem,s?.className,{"tabs__item--active":t===n}),children:a??n},n)}))})}function j(e){let{lazy:n,children:a,selectedValue:s}=e;const l=(Array.isArray(a)?a:[a]).filter(Boolean);if(n){const e=l.find((e=>e.props.value===s));return e?(0,t.cloneElement)(e,{className:(0,r.A)("margin-top--md",e.props.className)}):null}return(0,g.jsx)("div",{className:"margin-top--md",children:l.map(((e,n)=>(0,t.cloneElement)(e,{key:n,hidden:e.props.value!==s})))})}function w(e){const n=p(e);return(0,g.jsxs)("div",{className:(0,r.A)("tabs-container",v.tabList),children:[(0,g.jsx)(b,{...n,...e}),(0,g.jsx)(j,{...n,...e})]})}function y(e){const n=(0,x.A)();return(0,g.jsx)(w,{...e,children:c(e.children)},String(n))}},8453:(e,n,a)=>{a.d(n,{R:()=>l,x:()=>i});var t=a(6540);const r={},s=t.createContext(r);function l(e){const n=t.useContext(s);return t.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function i(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:l(e.components),t.createElement(s.Provider,{value:n},e.children)}}}]);